---
title: "Final Project Code"
format: pdf
editor: visual
author: "Aden Bhagwat, Emily Mingus, Erick Njue"
---

```{r load-packages}
library(here)
library(edld652)
library(rio)
library(tidyverse)
library(janitor)
library(knitr)
library(modelsummary)
options(modelsummary_factory_default =
          'kableExtra')
options(modelsummary_factory_latex =
          'kableExtra')
options(modelsummary_factory_html =
          'kableExtra')
```

\

```{r get-data}
get_documentation("EDFacts_rla_achievement_lea_2010_2019")
# get_documentation("EDFacts_math_achievement_lea_2010_2019")

###same documentation for both

# rla_achieve <- get_data("EDFacts_rla_achievement_lea_2010_2019") %>% 
#   clean_names()
# 
# rla_sub <- rla_achieve %>%
#   select(leaid, matches("^(ecd|all).*pctprof$"))
# 
# export(rla_sub, "Data/rla_sub.Rdata")
# 
# math_achieve <- get_data("EDFacts_math_achievement_lea_2010_2019") %>% 
#   clean_names()
# 
# math_sub <- math_achieve %>% 
#   select(leaid, matches("^(ecd|all).*pctprof$"))
# 
# export(math_sub, "Data/math_sub.Rdata")

rla_sub<-import(here("Data/rla_sub.Rdata"))
math_sub<-import(here("Data/math_sub.Rdata"))

```

```{r explore-data}

glimpse(rla_sub)
glimpse(math_sub)
str(rla_sub)

table_rla <- as.data.frame(table(rla_sub$all_rla00pctprof))
colnames(table_rla) <- c("Percent of Students Proficient", "Count") 
print(table_rla)

table_math <- as.data.frame(table(math_sub$all_mth00pctprof))
colnames(table_math) <- c("Percent of Students Proficient", "Count") 
print(table_math)
```

There are a range of ways data is measured, from exact percentages, to ranges, to greater than/less than statements. We need to come up with rules to standardize and drop n/a and PS values. I think maybe we could just take the lower number in the range, and print whatever number is reported in greater than/less than statements. We would need to add a disclaimer.

```{r data-cleaning}

rla_clean <- rla_sub %>%
  mutate(across(
    -leaid, 
    ~ gsub("-.*", "", .))) %>% 
  mutate(across(
    -leaid, 
    ~ gsub("^[A-Za-z]{2}([0-9]{1}).*", "\\1", .))) %>% 
  mutate(across(
    -leaid, 
    ~ gsub("^[A-Za-z]{1}([0-9]{2}).*", "\\1", .))) %>% 
  mutate(across(
    -leaid, 
    ~ na_if(., "PS"))) %>% 
  mutate(across(
    -leaid, 
    ~ na_if(., "n/a"))) %>% 
  mutate(across(
    everything(),
    as.numeric))

table(rla_clean$all_rla00pctprof, useNA = "ifany")
mean(rla_clean$all_rla00pctprof, na.rm=T)



math_clean <- math_sub %>%
  mutate(across(
    -leaid, 
    ~ gsub("-.*", "", .))) %>% 
  mutate(across(
    -leaid, 
    ~ gsub("^[A-Za-z]{2}([0-9]{1}).*", "\\1", .))) %>% 
  mutate(across(
    -leaid, 
    ~ gsub("^[A-Za-z]{1}([0-9]{2}).*", "\\1", .))) %>% 
  mutate(across(
    -leaid, 
    ~ na_if(., "PS"))) %>% 
  mutate(across(
    -leaid, 
    ~ na_if(., "n/a"))) %>% 
  mutate(across(
    everything(),
    as.numeric))

table(math_clean$all_mth00pctprof, useNA = "ifany")
mean(math_clean$all_mth00pctprof, na.rm=T)
```

Pivot data longer

This is a test to make sure I can push something. Here are also some ideas related to what visualizations we want to create. This is district level data. We are interested in investigating/visualizing grade level data to show proficiency scores across general population compared to low SES status -EM

```{r viz ideas}

#histograms

#Excludes the 'leaid' column from the data and calculate averages
column_averages <- colMeans(math_clean[, -1], na.rm = TRUE)

#Creates the 'Grade_Level' vector with the correct length (16 grades)
Grade_Level <- c( "1",  "2",  "3",  "4",  "5", 
                  "6",  "7",  "8", "9", "10", 
                 "11", "12", "13", "14", "15", "16")

#Ensures the length of Grade_Level matches column_averages
averages_df <- data.frame(
  Grade_Level = Grade_Level,
  Average_Proficiency = column_averages
)

ggplot(averages_df, aes(x = Grade_Level, y = Average_Proficiency)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  theme_minimal() +
  labs(
    title = "Average Math Proficiency by Grade Level",
    x = "Grade Level",
    y = "Average Proficiency (%)"
  ) +
  geom_text(aes(label = round(Average_Proficiency, 1)), vjust = -0.5)


```

```{r Research Questions}
#Research Questions
#1. Does the Social Economic Status (SES)affect profiency sccores?
# a)Does the Social Economic Status (SES)affect Math profiency sccores by grade level?
# b)Does the Social Economic Status (SES)affect Reading profiency sccores?
  
```
