---
title: "Final Project Code"
format: pdf
editor: visual
author: "Aden Bhagwat, Emily Mingus, Erick Njue"
---

```{r load-packages}
library(here)
library(edld652)
library(rio)
library(tidyverse)
library(janitor)
library(knitr)
library(modelsummary)
options(modelsummary_factory_default =
          'kableExtra')
options(modelsummary_factory_latex =
          'kableExtra')
options(modelsummary_factory_html =
          'kableExtra')
```

\

```{r get-data}
get_documentation("EDFacts_rla_achievement_lea_2010_2019")
# get_documentation("EDFacts_math_achievement_lea_2010_2019")

###same documentation for both

# rla_achieve <- get_data("EDFacts_rla_achievement_lea_2010_2019") %>% 
#   clean_names()
# 
# rla_sub <- rla_achieve %>%
#   select(leaid, matches("^(ecd|all).*pctprof$"))
# 
# export(rla_sub, "Data/rla_sub.Rdata")
# 
# math_achieve <- get_data("EDFacts_math_achievement_lea_2010_2019") %>% 
#   clean_names()
# 
# math_sub <- math_achieve %>% 
#   select(leaid, matches("^(ecd|all).*pctprof$"))
# 
# export(math_sub, "Data/math_sub.Rdata")

rla_sub<-import(here("Data/rla_sub.Rdata"))
math_sub<-import(here("Data/math_sub.Rdata"))

```

```{r explore-data}

glimpse(rla_sub)
glimpse(math_sub)
str(rla_sub)

table_rla <- as.data.frame(table(rla_sub$all_rla00pctprof))
colnames(table_rla) <- c("Percent of Students Proficient", "Count") 
print(table_rla)

table_math <- as.data.frame(table(math_sub$all_mth00pctprof))
colnames(table_math) <- c("Percent of Students Proficient", "Count") 
print(table_math)
```

There are a range of ways data is measured, from exact percentages, to ranges, to greater than/less than statements. We need to come up with rules to standardize and drop n/a and PS values. I think maybe we could just take the lower number in the range, and print whatever number is reported in greater than/less than statements. We would need to add a disclaimer.

```{r data-cleaning}

rla_clean <- rla_sub %>%
  mutate(across(
    -leaid, 
    ~ gsub("-.*", "", .))) %>% 
  mutate(across(
    -leaid, 
    ~ gsub("^[A-Za-z]{2}([0-9]{1}).*", "\\1", .))) %>% 
  mutate(across(
    -leaid, 
    ~ gsub("^[A-Za-z]{1}([0-9]{2}).*", "\\1", .))) %>% 
  mutate(across(
    -leaid, 
    ~ na_if(., "PS"))) %>% 
  mutate(across(
    -leaid, 
    ~ na_if(., "n/a"))) %>% 
  mutate(across(
    everything(),
    as.numeric))

table(rla_clean$all_rla00pctprof, useNA = "ifany")
mean(rla_clean$all_rla00pctprof, na.rm=T)



math_clean <- math_sub %>%
  mutate(across(
    -leaid, 
    ~ gsub("-.*", "", .))) %>% 
  mutate(across(
    -leaid, 
    ~ gsub("^[A-Za-z]{2}([0-9]{1}).*", "\\1", .))) %>% 
  mutate(across(
    -leaid, 
    ~ gsub("^[A-Za-z]{1}([0-9]{2}).*", "\\1", .))) %>% 
  mutate(across(
    -leaid, 
    ~ na_if(., "PS"))) %>% 
  mutate(across(
    -leaid, 
    ~ na_if(., "n/a"))) %>% 
  mutate(across(
    everything(),
    as.numeric))

table(math_clean$all_mth00pctprof, useNA = "ifany")
mean(math_clean$all_mth00pctprof, na.rm=T)
```

Note: May need to pivot data longer

### Below are our research questions:

**Research Question #1:** Does Socioeconomic Status (SES) affect educational proficiency sccores?

If SES affects proficiency scores, then:

**#1a:** Does Socioeconomic Status (SES) affect Math proficiency scores differently by grade level?

**#1b:** Does Socioeconomic Status (SES) affect Reading proficiency scores differently by grade level?

### Visualization Ideas

Here are also some ideas related to what visualizations we want to create. This is district level data. We are interested in investigating/visualizing grade level data to show proficiency scores across general population compared to low SES status. The audiences will vary and we will want to customize the visuals based on who the intended target is.

The scenario may be we are informing district administrators of disparities across schools/grade-level as it relates to proficiency scores. This information would be useful in determining what schools/grade levels may benefit from additional supports to increase proficiency. Based on our research questions above, here are some ideas generated during the team meeting.

For Question 1: Does SES affect proficiency scores?

-   Boxplot: Compare Math and Reading proficiency scores across SES groups

-   Bar Plot with Error Bars: Show mean proficiency scores (Math and Reading) by SES with error bar

-   Violin Plot: Visualize the distribution of proficiency scores by SES

For Question 1a: Does SES affect Math proficiency scores by grade level?

-   Line Plot: Show Math proficiency trends by grade level for each SES group

-   Faceted Bar Plot: Display average Math scores by grade level and SES

-   Heatmap: Visualize Math proficiency across SES and grade levels

For Question 1b: Does SES affect Reading proficiency scores?

-   Side-by-Side Boxplots: Compare Reading proficiency across SES groups for each grade level

-   Stacked Bar Chart: Show the distribution of proficiency levels (Math/Reading) by SES

-   Grouped Bar Plot: Compare average Reading scores by SES and grade level

General Visualizations:

-   Scatter Plot: Explore SES vs proficiency scores (Math/Reading)

-   Density Plot: Compare distribution of proficiency scores by SES

```{r viz ideas}

#histograms

#Excludes the 'leaid' column from the data and calculate averages
column_averages <- colMeans(math_clean[, -1], na.rm = TRUE)

#Creates the 'Grade_Level' vector with the correct length (16 grades)
Grade_Level <- c( "1",  "2",  "3",  "4",  "5", 
                  "6",  "7",  "8", "9", "10", 
                 "11", "12", "13", "14", "15", "16")

#Ensures the length of Grade_Level matches column_averages
averages_df <- data.frame(
  Grade_Level = Grade_Level,
  Average_Proficiency = column_averages
)

ggplot(averages_df, aes(x = Grade_Level, y = Average_Proficiency)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  theme_minimal() +
  labs(
    title = "Average Math Proficiency by Grade Level",
    x = "Grade Level",
    y = "Average Proficiency (%)"
  ) +
  geom_text(aes(label = round(Average_Proficiency, 1)), vjust = -0.5)


#second run the x-axis does not look as good, will need fixed

```
